<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Portfolio of Vincent Kipyegon, Geospatial Engineer and GIS Analyst specializing in flood risk modeling, remote sensing, and web mapping." />
  <meta name="keywords" content="Vincent Kipyegon, Geospatial Engineer, GIS Analyst, Remote Sensing, Google Earth Engine, ArcGIS, QGIS" />
  <title>Vincent Kipyegon — Geospatial Engineer Portfolio</title>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- Leaflet (mini maps) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-sA+oY0gY1Wk5m0s0l8g+Fw3Q8yF3Oq8m5v6ZY1zYg2M=" crossorigin=""/>
  <style>
    :root{
      --bg:#07102a;
      --panel:#0b1220;
      --muted:#94a3b8;
      --accent:#2563eb;
      --accent-2:#7c3aed;
      --glass: rgba(255,255,255,0.03);
      --radius:14px;
      --maxw:1100px;
    }

    /* Reset & base */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:'Inter', Arial, sans-serif;
      background: linear-gradient(180deg,#071024 0%,var(--bg) 60%);
      color:#e6eef8;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.5;
      padding:32px 16px 80px;
    }

    .container{
      max-width:var(--maxw);
      margin:0 auto;
      padding:0 18px;
    }

    /* Header */
    header{
      text-align:center;
      margin-bottom:18px;
    }
    header h1{
      margin:0;
      font-size:1.9rem;
      font-weight:800;
      color:#fff;
    }
    header p{ margin:6px 0; color:var(--muted) }

    nav{
      display:flex;
      justify-content:center;
      gap:10px;
      margin-top:10px;
      flex-wrap:wrap;
    }
    nav a{
      color:var(--muted);
      text-decoration:none;
      padding:6px 10px;
      border-radius:999px;
      font-weight:600;
      transition:all 180ms ease;
    }
    nav a:hover{ color:#fff; transform:translateY(-3px) }

    /* Hero */
    .hero{
      display:grid;
      grid-template-columns: 160px 1fr;
      gap:18px;
      align-items:center;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:var(--radius);
      padding:18px;
      border:1px solid var(--glass);
      box-shadow: 0 12px 40px rgba(2,6,23,0.55);
      transition: transform 260ms ease;
      overflow:clip;
    }
    .profile{
      width:150px;
      height:150px;
      border-radius:16px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.06);
      background:linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .profile img{ width:100%; height:100%; object-fit:cover; display:block }

    .hero-content h2{ margin:0 0 6px 0; color:#fff; font-size:1.35rem }
    .hero-content p{ margin:0 0 12px 0; color:var(--muted) }

    /* Animated gradient subtle background */
    .animated-gradient {
      background-size:300% 300%;
      animation: gradientMove 10s linear infinite;
    }
    @keyframes gradientMove {
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }

    /* CTA buttons */
    .cta-group{ display:flex; gap:12px; flex-wrap:wrap; align-items:center }
    .btn{
      display:inline-flex;
      align-items:center;
      gap:0.6rem;
      padding:10px 14px;
      border-radius:10px;
      text-decoration:none;
      font-weight:700;
      font-size:0.95rem;
      transition: all 260ms cubic-bezier(.2,.9,.3,1);
      box-shadow: 0 8px 22px rgba(11,20,34,0.45);
      border:1px solid rgba(255,255,255,0.04);
      color:white;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
    }
    .btn.secondary{
      background:transparent;
      color:var(--accent);
      border:1px solid rgba(37,99,235,0.18);
      box-shadow:none;
    }
    .btn:hover{ transform: translateY(-4px) scale(1.01); box-shadow:0 18px 48px rgba(37,99,235,0.12) }

    /* Project grid */
    .project-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap:16px;
      margin-top:16px;
    }
    .project-card{
      background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:12px;
      border:1px solid rgba(255,255,255,0.03);
      transition: transform 260ms ease, box-shadow 260ms ease;
      box-shadow: 0 6px 20px rgba(1,8,20,0.55);
    }
    .project-card:hover{ transform: translateY(-8px); box-shadow: 0 26px 60px rgba(2,6,23,0.65); }
    .project-card h3{ margin:8px 0 6px 0; color:#fff }
    .project-card p{ color:var(--muted); margin:0.2rem 0; font-size:0.95rem }

    /* mini-map placeholder */
    .mini-map{
      width:100%;
      height:160px;
      border-radius:8px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.03);
    }

    /* map pin (small decorative element) */
    .map-pin{
      display:inline-block;
      width:12px; height:12px;
      border-radius:50%;
      background:#10b981;
      position:relative;
      margin-right:8px;
      vertical-align:middle;
    }
    .map-pin::after{
      content:""; position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
      width:100%; height:100%; border-radius:50%; background:rgba(16,185,129,0.45);
      animation: ping 1400ms cubic-bezier(.4,0,.2,1) infinite;
    }
    @keyframes ping{
      0%{ transform:translate(-50%,-50%) scale(1); opacity:0.9 }
      70%{ transform:translate(-50%,-50%) scale(2.4); opacity:0 }
      100%{ transform:translate(-50%,-50%) scale(2.4); opacity:0 }
    }

    /* Contact icons */
    #contact{ margin-top:14px; text-align:center }
    .contact-icons{
      display:flex; justify-content:center; gap:12px; margin-top:10px; flex-wrap:wrap;
    }
    .contact-icons .icon{
      width:52px; height:52px; display:inline-flex; align-items:center; justify-content:center;
      border-radius:10px; font-size:1.2rem; color:var(--accent);
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      border:1px solid rgba(37,99,235,0.06);
      transition:all 240ms ease; text-decoration:none;
      box-shadow: 0 8px 20px rgba(2,6,23,0.45);
    }
    .contact-icons .icon:hover{ transform:translateY(-6px) scale(1.03); color:white; background: linear-gradient(90deg,var(--accent),var(--accent-2)); box-shadow: 0 20px 50px rgba(37,99,235,0.16) }

    /* Stats */
    .stats{
      display:flex; gap:18px; margin-top:12px; flex-wrap:wrap; align-items:center;
    }
    .stat{
      background: rgba(255,255,255,0.01); padding:10px 12px; border-radius:8px; min-width:120px;
      border:1px solid rgba(255,255,255,0.02); text-align:center;
    }
    .stat-number{ font-size:1.25rem; font-weight:800; color:#fff }
    .stat-label{ font-size:0.85rem; color:var(--muted); margin-top:6px }

    /* Footer */
    footer{ margin-top:22px; padding:18px; border-radius:12px; background: linear-gradient(180deg, rgba(10,14,22,0.75), rgba(8,10,16,0.9)); border:1px solid rgba(255,255,255,0.02); box-shadow: 0 18px 50px rgba(2,6,23,0.7) }
    .footer-inner{ display:flex; justify-content:space-between; gap:12px; align-items:center; flex-wrap:wrap }
    .footer-brand{ display:flex; gap:10px; align-items:center }
    .logo{ width:46px; height:46px; border-radius:10px; background: linear-gradient(90deg,var(--accent),var(--accent-2)); display:flex; align-items:center; justify-content:center; color:#fff; font-weight:800 }
    .footer-links{ display:flex; gap:10px; align-items:center }
    .footer-links a{ color:var(--muted); text-decoration:none; padding:8px 10px; border-radius:8px; transition:all 160ms ease }
    .footer-links a:hover{ color:#fff; background: rgba(255,255,255,0.02); transform:translateY(-4px) }
    .legal{ margin-top:10px; color:var(--muted); font-size:0.9rem; text-align:center }

    /* Fade-in utility (scroll reveal) */
    .fade-in{
      opacity:0; transform: translateY(8px); transition: opacity 520ms ease, transform 520ms ease;
      will-change: opacity, transform;
    }
    .fade-in.visible{ opacity:1; transform: translateY(0) }

    /* Responsive */
    @media (max-width:860px){
      .hero{ grid-template-columns: 120px 1fr }
      .project-grid{ grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)) }
    }
    @media (max-width:520px){
      .hero{ grid-template-columns: 1fr; text-align:center; gap:12px }
      .profile{ margin:0 auto }
      .cta-group{ justify-content:center }
    }
  </style>
</head>
<body>
  <header class="container">
    <h1>Vincent Kipyegon</h1>
    <p>Geospatial Engineer | GIS Analyst | Remote Sensing Specialist — Nairobi, Kenya</p>
    <nav aria-label="Primary navigation">
      <a href="#home">Home</a>
      <a href="#about">About</a>
      <a href="#projects">Projects</a>
      <a href="#contact">Contact</a>
    </nav>
  </header>

  <main class="container" id="home">
    <!-- Hero -->
    <section class="hero animated-gradient fade-in" aria-labelledby="hero-heading">
      <div class="profile" aria-hidden="true">
        <img src="images/profile.jpg" alt="Vincent Kipyegon — profile photo">
      </div>

      <div class="hero-content">
        <h2 id="hero-heading">Welcome to My Portfolio</h2>
        <p>Hi, I'm Vincent Kipyegon — a geospatial engineer delivering data-driven solutions for climate action, agriculture, and urban resilience.</p>

        <!-- small hero mini-map + coords (geospatial cue) -->
        <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-bottom:10px;">
          <div style="width:200px;">
            <div id="hero-mini" class="mini-map" aria-hidden="false"></div>
            <div style="text-align:center; color:var(--muted); font-size:0.85rem; margin-top:6px;">Lake Baringo — 0.5°N, 36.0°E</div>
          </div>

          <div style="flex:1; min-width:200px;">
            <div class="cta-group" role="group" aria-label="Primary actions">
              <a href="cv.pdf" class="btn" target="_blank" rel="noopener noreferrer" aria-label="Open CV in new tab">
                <i class="fas fa-file-pdf" aria-hidden="true"></i> Open My CV
              </a>
              <a href="cv.pdf" class="btn secondary" download aria-label="Download CV">
                <i class="fas fa-download" aria-hidden="true"></i> Download My CV
              </a>
            </div>

            <div class="stats" style="margin-top:12px;">
              <div class="stat">
                <div class="stat-number" data-target="8">0</div>
                <div class="stat-label">Years data processed</div>
              </div>
              <div class="stat">
                <div class="stat-number" data-target="1240">0</div>
                <div class="stat-label">Buildings analyzed</div>
              </div>
              <div class="stat">
                <div class="stat-number" data-target="35">0</div>
                <div class="stat-label">Maps & dashboards</div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </section>

    <!-- About -->
    <section id="about" class="fade-in" style="margin-top:18px;">
      <h2>About Me</h2>
      <p>I'm a solutions-driven Geospatial Engineering student at the University of Nairobi with expertise in spatial data analysis, flood risk modeling, remote sensing, and dashboard development. Using tools like Google Earth Engine, ArcGIS Pro, QGIS, and Blender, I deliver actionable geospatial insights for NGOs, startups, and academic partners.</p>
      <p>As a freelancer and research contributor, I’ve worked on projects ranging from predictive modeling to visualization and mapping, driving impact in climate action and urban resilience.</p>

      <h3 style="margin-top:10px;">Skills & Tools</h3>
      <ul style="color:var(--muted);">
        <li><strong>Geospatial Tools</strong>: ArcGIS Pro, QGIS, AutoCAD, SAGA GIS, Blender, Google Earth Engine (JavaScript &amp; Python), Photogrammetry</li>
        <li><strong>Programming & Tools</strong>: Python, Git, Jupyter Notebook, HTML/CSS (learning), Excel (Advanced)</li>
        <li><strong>Data & Visualization</strong>: Power BI, Tableau, Google Sheets, Data Scraping, Geocoding, Spatial Modelling</li>
        <li><strong>Web Mapping & Remote Sensing</strong>: Sentinel-1, Sentinel-2, Landsat, Web Apps (GEE)</li>
        <li><strong>Soft Skills</strong>: Report Writing, Client Communication, Proposal Writing, Time Management, Teamwork</li>
      </ul>
    </section>

    <!-- Projects (each card uses a mini-map thumbnail that animates when visible) -->
    <section id="projects" class="fade-in" style="margin-top:18px;">
      <h2>My Projects</h2>
      <div class="project-grid" role="list">
        <!-- 1 -->
        <article class="project-card fade-in" role="listitem" aria-labelledby="p1" data-map-id="map-1" data-lat="0.5" data-lon="36.0" data-zoom="11">
          <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
            <span class="map-pin" aria-hidden="true"></span>
            <h3 id="p1">Flood Risk Prediction Model – Baringo County</h3>
          </div>
          <div id="map-1" class="mini-map" aria-hidden="false"></div>
          <p>Developed a predictive flood model using Sentinel-1 and Google Earth Engine, integrating building exposure analysis. Built a scalable dashboard for disaster management.</p>
          <p style="color:var(--muted);"><strong>Tools</strong>: Google Earth Engine, Sentinel-1, ArcGIS Pro, QGIS — <strong>Year</strong>: 2025</p>
          <a href="https://github.com/Pyexxy/flood-baringo" class="btn" target="_blank" rel="noopener noreferrer" aria-label="View flood-baringo code on GitHub">
            <i class="fab fa-github" aria-hidden="true"></i> View Code
          </a>
        </article>

        <!-- 2 -->
        <article class="project-card fade-in" role="listitem" aria-labelledby="p2" data-map-id="map-2" data-lat="2.2" data-lon="40.9" data-zoom="10">
          <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
            <span class="map-pin" aria-hidden="true"></span>
            <h3 id="p2">Mangrove Vegetation &amp; Temperature Correlation – Lamu County</h3>
          </div>
          <div id="map-2" class="mini-map" aria-hidden="false"></div>
          <p>Analyzed NDVI and land surface temperature using Sentinel-2 and MODIS LST. Secured 2nd place in the GESA GIS Week Visualization Challenge.</p>
          <p style="color:var(--muted);"><strong>Tools</strong>: Google Earth Engine, Sentinel-2, MODIS LST — <strong>Year</strong>: 2024</p>
          <a href="https://github.com/Pyexxy/mangrove-lamu" class="btn" target="_blank" rel="noopener noreferrer" aria-label="View mangrove-lamu code on GitHub">
            <i class="fab fa-github" aria-hidden="true"></i> View Code
          </a>
        </article>

        <!-- 3 -->
        <article class="project-card fade-in" role="listitem" aria-labelledby="p3" data-map-id="map-3" data-lat="0.5167" data-lon="35.2833" data-zoom="11">
          <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
            <span class="map-pin" aria-hidden="true"></span>
            <h3 id="p3">Urban Growth Analysis – Eldoret City</h3>
          </div>
          <div id="map-3" class="mini-map" aria-hidden="false"></div>
          <p>Detected urban sprawl patterns using Sentinel-2 and Jupyter Notebook. Awarded Best Project at RCMRD’s Mjini Hackathon.</p>
          <p style="color:var(--muted);"><strong>Tools</strong>: Jupyter Notebook, DUNIA, Sentinel-2 — <strong>Year</strong>: 2024</p>
          <a href="https://github.com/Pyexxy/urban-eldoret" class="btn" target="_blank" rel="noopener noreferrer" aria-label="View urban-eldoret code on GitHub">
            <i class="fab fa-github" aria-hidden="true"></i> View Code
          </a>
        </article>

        <!-- 4 -->
        <article class="project-card fade-in" role="listitem" aria-labelledby="p4" data-map-id="map-4" data-lat="1.0" data-lon="35.0" data-zoom="9">
          <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
            <span class="map-pin" aria-hidden="true"></span>
            <h3 id="p4">Predictive Maize Yield Model – Trans Nzoia County</h3>
          </div>
          <div id="map-4" class="mini-map" aria-hidden="false"></div>
          <p>Modeled maize yield impacts using MODIS, CHIRPS, and WorldPop data to support agricultural planning.</p>
          <p style="color:var(--muted);"><strong>Tools</strong>: Google Earth Engine, MODIS, CHIRPS — <strong>Year</strong>: 2025</p>
          <a href="https://github.com/Pyexxy/maize-transnzoia" class="btn" target="_blank" rel="noopener noreferrer" aria-label="View maize-transnzoia code on GitHub">
            <i class="fab fa-github" aria-hidden="true"></i> View Code
          </a>
        </article>

        <!-- 5 -->
        <article class="project-card fade-in" role="listitem" aria-labelledby="p5" data-map-id="map-5" data-lat="0.3" data-lon="36.2" data-zoom="11">
          <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
            <span class="map-pin" aria-hidden="true"></span>
            <h3 id="p5">Topographic Map Series – VGI Data</h3>
          </div>
          <div id="map-5" class="mini-map" aria-hidden="false"></div>
          <p>Created a 1:12,500-scale topographic map series using OSM and SRTM data, with contours and land cover layers.</p>
          <p style="color:var(--muted);"><strong>Tools</strong>: QGIS, SRTM, OpenStreetMap, ArcMap — <strong>Year</strong>: 2025</p>
          <a href="https://github.com/Pyexxy/topographic-vgi" class="btn" target="_blank" rel="noopener noreferrer" aria-label="View topographic-vgi code on GitHub">
            <i class="fab fa-github" aria-hidden="true"></i> View Code
          </a>
        </article>
      </div>
    </section>

    <!-- Contact -->
    <section id="contact" class="fade-in" style="margin-top:18px;">
      <h2>Contact Me</h2>
      <div class="contact-icons" role="navigation" aria-label="Contact links">
        <a href="mailto:vincentkipyegon02@gmail.com" class="icon" title="Email" aria-label="Email Vincent">
          <i class="fas fa-envelope" aria-hidden="true"></i>
        </a>

        <a href="https://www.linkedin.com/in/pyexxy" class="icon" target="_blank" rel="noopener noreferrer" title="LinkedIn" aria-label="LinkedIn profile">
          <i class="fab fa-linkedin" aria-hidden="true"></i>
        </a>

        <a href="https://github.com/Pyexxy" class="icon" target="_blank" rel="noopener noreferrer" title="GitHub" aria-label="GitHub profile">
          <i class="fab fa-github" aria-hidden="true"></i>
        </a>

        <a href="https://wa.me/254705264308" class="icon" target="_blank" rel="noopener noreferrer" title="WhatsApp" aria-label="WhatsApp chat">
          <i class="fab fa-whatsapp" aria-hidden="true"></i>
        </a>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="container">
    <div class="footer-inner">
      <div class="footer-brand">
        <div class="logo" aria-hidden="true">VK</div>
        <div>
          <div style="color:#fff; font-weight:700;">Vincent Kipyegon</div>
          <div style="color:var(--muted); font-size:0.95rem;">Geospatial Engineer — Nairobi, Kenya</div>
        </div>
      </div>

      <div class="footer-links" aria-hidden="false">
        <a href="#projects">Projects</a>
        <a href="#about">About</a>
        <a href="#contact">Contact</a>
        <a href="cv.pdf" target="_blank" rel="noopener noreferrer">View CV</a>
      </div>
    </div>

    <div class="legal">© 2025 Vincent Kipyegon. All rights reserved.</div>
  </footer>

  <!-- Leaflet JS (mini-maps) -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-o9N1jH1Be0k6j6qv8b6o2u2x3zYpI7qvOq3g9k+DQj4=" crossorigin=""></script>

  <script>
    /* ====== Utilities ====== */

    // Initialize a mini Leaflet map (keeps UI minimal and non-interactive)
    function createMiniMap(containerId, lat, lon, zoom){
      try {
        const map = L.map(containerId, {
          zoomControl: false,
          attributionControl: false,
          scrollWheelZoom: false,
          dragging: false,
          doubleClickZoom: false,
          boxZoom: false,
          keyboard: false,
          tap: false,
        }).setView([lat, lon], zoom);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19
        }).addTo(map);

        L.circleMarker([lat, lon], {
          radius: 6,
          color: '#ffffff',
          weight: 2,
          fillColor: '#2563eb',
          fillOpacity: 1
        }).addTo(map);

        // gentle autoplay pan/zoom loop
        const path = [
          [lat, lon],
          [lat + (0.004), lon + (0.007)],
          [lat - (0.003), lon - (0.005)]
        ];
        let step = 0;
        const stepDuration = 3800;
        const flyOptions = { duration: 3 };

        const interval = setInterval(() => {
          try {
            step = (step + 1) % path.length;
            const target = path[step];
            const nextZoom = zoom + ((step % 2) ? 0 : 1);
            map.flyTo(target, nextZoom, flyOptions);
          } catch (err) {
            clearInterval(interval);
          }
        }, stepDuration);

        // return an object so we can optionally interact later
        return { map, interval };
      } catch (e) {
        // Leaflet failed (rare). Fallback silently.
        return null;
      }
    }

    /* ====== Lazy init maps & scroll reveal ====== */

    // IntersectionObserver for fade-in and for lazy-initializing maps & stats
    const revealObserver = new IntersectionObserver((entries, obs) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');

          // If this is a project card with a data-map-id and not yet initialized, init map
          if (entry.target.matches('.project-card') && !entry.target.dataset.initialized) {
            entry.target.dataset.initialized = 'true';
            const mapId = entry.target.dataset.mapId;
            const lat = parseFloat(entry.target.dataset.lat) || 0;
            const lon = parseFloat(entry.target.dataset.lon) || 0;
            const zoom = parseInt(entry.target.dataset.zoom) || 11;
            if (mapId) {
              // small delay to avoid heavy paint during scroll
              setTimeout(() => { createMiniMap(mapId, lat, lon, zoom); }, 350);
            }
          }

          // If hero mini map
          if (entry.target.id === 'hero-mini' && !entry.target.dataset.initialized) {
            entry.target.dataset.initialized = 'true';
            setTimeout(() => { createMiniMap('hero-mini', 0.5, 36.0, 11); }, 200);
          }

          // If stat numbers appear, animate them once
          const statNum = entry.target.querySelectorAll ? entry.target.querySelectorAll('.stat-number') : null;
          if (statNum && statNum.length) {
            statNum.forEach(el => animateCounter(el));
          }

          // If an individual stat-number appears (outside container), animate
          if (entry.target.classList && entry.target.classList.contains('stat-number')) {
            animateCounter(entry.target);
          }

          // stop observing elements once revealed to reduce work
          // but keep project-cards observed only until initialized
          if (!entry.target.classList.contains('project-card')) obs.unobserve(entry.target);
        }
      });
    }, { threshold: 0.12 });

    // Observe elements with .fade-in, hero-mini, and stat-number elements
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.fade-in').forEach(el => revealObserver.observe(el));
      const heroMini = document.getElementById('hero-mini');
      if (heroMini) revealObserver.observe(heroMini);
      document.querySelectorAll('.stat-number').forEach(el => revealObserver.observe(el));
      // Also observe project-cards so maps initialize when they come into view
      document.querySelectorAll('.project-card').forEach(el => revealObserver.observe(el));
    });

    /* ====== Animated counters ====== */
    function animateCounter(el) {
      if (el.dataset.animated) return;
      el.dataset.animated = 'true';
      const target = parseInt(el.dataset.target) || 0;
      let current = 0;
      const duration = 1100;
      const frameRate = 20;
      const steps = Math.ceil(duration / frameRate);
      const stepVal = Math.max(1, Math.floor(target / steps));
      const timer = setInterval(() => {
        current += stepVal;
        if (current >= target) {
          el.textContent = target.toLocaleString();
          clearInterval(timer);
        } else {
          el.textContent = current.toLocaleString();
        }
      }, frameRate);
    }

    /* ====== Accessibility: reduce motion on OS preference ====== */
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)');
    if (prefersReducedMotion.matches) {
      // If reduced motion is requested, remove animations and stop map flyTo loops
      window.createMiniMap = function(containerId, lat, lon, zoom) {
        try {
          const map = L.map(containerId, {
            zoomControl:false, attributionControl:false, scrollWheelZoom:false, dragging:false
          }).setView([lat, lon], zoom);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
          L.circleMarker([lat, lon], { radius:6, color:'#fff', weight:2, fillColor:'#2563eb', fillOpacity:1 }).addTo(map);
          return { map, interval: null };
        } catch (e) { return null; }
      }
      // stop CSS animations by removing animated classes
      document.documentElement.classList.add('reduce-motion');
      const style = document.createElement('style');
      style.innerHTML = `* { transition: none !important; animation: none !important }`;
      document.head.appendChild(style);
    }
  </script>
</body>
</html>
